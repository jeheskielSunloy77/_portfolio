---
import '../styles/global.css'
import Footer from '@/components/footer.astro'
import { ChatBot } from '@/components/chat-bot'
import { ClientRouter } from 'astro:transitions'
import Seo from '@/components/seo.astro'
import type { ComponentProps } from 'astro/types'
import Navbar from '@/components/navbar.astro'
import ArticleSchema from '@/components/article-schema.astro'
import { DEFAULT_LANGUAGE, type Language } from '@/i18n/i18n'

export interface Props {
	seo: ComponentProps<typeof Seo>
	articleSchema?: ComponentProps<typeof ArticleSchema>
	lang: Language
}

const { seo, articleSchema, lang } = Astro.props
---

<html lang={lang}>
	<head>
		<script is:inline data-astro-rerun>
			;(() => {
				const theme = localStorage.getItem('theme')
				const prefersDark = window.matchMedia(
					'(prefers-color-scheme: dark)'
				).matches
				if (theme === 'dark' || (!theme && prefersDark)) {
					document.documentElement.classList.add('dark')
				} else {
					document.documentElement.classList.remove('dark')
				}
			})()
		</script>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<Seo {...seo} />
		{articleSchema && <ArticleSchema {...articleSchema} />}
		<ClientRouter />
	</head>
	<body>
		<Navbar lang={lang} />
		<div class='mx-auto flex max-w-3xl flex-col px-8'>
			<main class='grow'>
				<slot />
			</main>
			<ChatBot client:idle lang={lang} />
		</div>
		<Footer lang={lang} />
	</body>
</html>
